@page
@model HotelBookingApp.Pages.Admin.Rooms.CreateModel
@{
    ViewData["Title"] = "Create Room";
    Layout = "_Layout";
}

<div class="container mt-4">
    <h2>Add New Room</h2>

    <form id="roomForm" onsubmit="createRoom(event)">
        <div class="mb-3">
            <label>Hotel</label>
            <select id="hotelSelect" class="form-select" required></select>
        </div>
        <div class="mb-3">
            <label>Room Number</label>
            <input id="number" class="form-control" required />
        </div>
        <div class="mb-3">
            <label>Price per Night</label>
            <input id="price" type="number" class="form-control" required step="0.01" />
        </div>
        <div class="mb-3">
            <label>Capacity</label>
            <input id="capacity" type="number" class="form-control" required />
        </div>
        <button class="btn btn-success">Save</button>
    </form>
</div>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", loadHotels);

        async function loadHotels() {
            const res = await fetch("/api/hotels");
            const hotels = await res.json();
            const select = document.getElementById("hotelSelect");
            select.innerHTML = hotels.map(h => `<option value="${h.id}">${h.name}</option>`).join("");
        }

        async function createRoom(e) {
            e.preventDefault();

            const hotelId = document.getElementById("hotelSelect").value;
            const number = document.getElementById("number").value;
            const pricePerNight = parseFloat(document.getElementById("price").value);
            const capacity = parseInt(document.getElementById("capacity").value);

            const response = await fetch("/api/rooms", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ hotelId, number, pricePerNight, capacity })
            });

            if (response.ok) {
                alert("Room created!");
                window.location.href = "/Admin/Rooms";
            } else {
                alert("Error creating room.");
            }
        }
    </script>
}